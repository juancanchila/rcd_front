<div class="form-host">
  <!-- Barra de progreso -->
  <mat-progress-bar mode="determinate" [value]="(step + 1) * (100 / totalSteps)">
  </mat-progress-bar>

  <!-- PASO 0: DATOS DE CONTACTO -->
  <div *ngIf="step === 0" [formGroup]="contacto">
    <h3>Datos de Contacto</h3>
    <p>Ingresar la información del propietario del vehículo.</p>

    <mat-form-field appearance="outline">
      <mat-label>Tipo de solicitante</mat-label>
      <mat-select formControlName="tipo_de_solicitante" required>
        <mat-option value="Persona Natural">Persona Natural</mat-option>
        <mat-option value="Persona Jurídica">Persona Jurídica</mat-option>
      </mat-select>
      <mat-error *ngIf="isInvalid('tipo_de_solicitante', contacto)">
        Debes seleccionar el tipo de solicitante.
      </mat-error>
    </mat-form-field>

    <!-- Persona Natural -->
    <ng-container *ngIf="contacto.get('tipo_de_solicitante')?.value === 'Persona Natural'">
      <mat-form-field appearance="outline">
        <mat-label>Nombres y apellidos</mat-label>
        <input matInput formControlName="nombres_y_apellidos" placeholder="Ej: Juan Pérez" />
        <mat-error *ngIf="isInvalid('nombres_y_apellidos', contacto)">
          Debes ingresar nombres y apellidos.
        </mat-error>
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>Documento de identidad</mat-label>
        <input matInput type="number" formControlName="documento_de_identidad" placeholder="Ej: 1234567890" />
        <mat-error *ngIf="isInvalid('documento_de_identidad', contacto)">
          Debes ingresar el documento de identidad.
        </mat-error>
      </mat-form-field>
    </ng-container>

    <!-- Persona Jurídica -->
    <ng-container *ngIf="contacto.get('tipo_de_solicitante')?.value === 'Persona Jurídica'">
      <mat-form-field appearance="outline">
        <mat-label>Razón social</mat-label>
        <input
          matInput
          type="number"
          formControlName="razon_social"
          placeholder="Ej: Comercializadora ABC S.A.S"
        />
        <mat-error *ngIf="isInvalid('razon_social', contacto)">
          Debes ingresar la razón social.
        </mat-error>
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>NIT</mat-label>
        <input matInput type="number" formControlName="nit" placeholder="Ej: 900123456-7" />
        <mat-error *ngIf="isInvalid('nit', contacto)"> Debes ingresar el NIT. </mat-error>
      </mat-form-field>
    </ng-container>

    <mat-form-field appearance="outline">
      <mat-label>Correo electrónico</mat-label>
      <input
        matInput
        type="email"
        formControlName="correo_electronico"
        placeholder="ejemplo@correo.com"
      />
      <mat-error *ngIf="isInvalid('correo_electronico', contacto)">
        Ingresa un correo válido.
      </mat-error>
    </mat-form-field>

    <mat-form-field appearance="outline">
      <mat-label>Teléfono móvil</mat-label>
      <input matInput type="number" formControlName="telefono_movil" placeholder="Ej: 3001234567"  />
      <mat-error *ngIf="isInvalid('telefono_movil', contacto)">
        Debes ingresar el teléfono móvil.
      </mat-error>
    </mat-form-field>

    <mat-form-field appearance="outline">
      <mat-label>Teléfono fijo</mat-label>
      <input matInput type="number" formControlName="telefono_fijo" placeholder="Ej: 6051234567" />
    </mat-form-field>

    <mat-form-field appearance="outline">
      <mat-label>Localidad</mat-label>
      <mat-select formControlName="localidad" required>
        <mat-option value="localidad1">Localidad 1</mat-option>
        <mat-option value="localidad2">Localidad 2</mat-option>
        <mat-option value="localidad3">Localidad 3</mat-option>
      </mat-select>
      <mat-error *ngIf="isInvalid('localidad', contacto)">
        Debes seleccionar la localidad.
      </mat-error>
    </mat-form-field>

    <mat-form-field appearance="outline">
      <mat-label>Barrio</mat-label>
      <input
        matInput
        formControlName="barrio"
        [matAutocomplete]="autoBarrio"
        placeholder="Empieza a escribir"
      />
      <mat-autocomplete #autoBarrio="matAutocomplete">
        <mat-option *ngFor="let barrio of barriosFiltrados$ | async" [value]="barrio">{{
          barrio
        }}</mat-option>
      </mat-autocomplete>
      <mat-error *ngIf="isInvalid('barrio', contacto)"> Debes seleccionar un barrio. </mat-error>
    </mat-form-field>

    <mat-form-field appearance="outline">
      <mat-label>Dirección de correspondencia</mat-label>
      <input
        matInput
        formControlName="direccion_de_correspondencia_del_solicitante"
        placeholder="Ej: Calle 45 #12-34"
      />
      <mat-error *ngIf="isInvalid('direccion_de_correspondencia_del_solicitante', contacto)">
        Debes ingresar la dirección de correspondencia.
      </mat-error>
    </mat-form-field>
  </div>

  <div class="form-actions">
    <button mat-flat-button color="primary" (click)="nextStep()">Siguiente</button>
  </div>

  <!-- PASO 1 — DATOS DEL Proyecto -->
  <div *ngIf="step === 1" [formGroup]="proyecto">
    <project-data [group]="proyecto!"></project-data>

    <!-- Fechas -->
    <div class="flexbox">
      <div class="form-field">
        <label>Fecha Inicio</label>
        <input type="date" formControlName="fecha_inicio" [min]="minDate" max="2026-12-31" />
      </div>

      <div class="form-field">
        <label>Fecha Final <span class="required">*</span></label>
        <input type="date" formControlName="fecha_final" [min]="minDate" max="2026-12-31" />
        <div class="error" *ngIf="isInvalid('fecha_final', proyecto)">Seleccionar fecha</div>
      </div>
    </div>

    <div *ngIf="proyecto.errors?.['fechaInvalida']" class="error">
      La fecha inicial no puede ser mayor que la fecha final.
    </div>

    <map-picker (coordinates)="onMap($event)"></map-picker>

    <div
      class="error"
      *ngIf="
        proyecto.get('latitud')?.invalid &&
        (proyecto.get('latitud')?.touched || proyecto.get('longitud')?.touched)
      "
    >
      Debes seleccionar una ubicación en el mapa.
    </div>

    <div class="form-actions">
       <button mat-stroked-button type="button" (click)="prevStep()">Anterior</button>
      <button mat-flat-button color="primary" (click)="nextStep()">Siguiente</button>
    </div>
  </div>

  <!-- PASO 2: DOCUMENTOS -->
  <div *ngIf="step === 2" [formGroup]="DocumentsForm" class="vehicle-documents">
    <!-- Documentos para Pequeño Generador que no requiere licencia -->
    <div
      *ngIf="
        proyecto.get('tipo_de_generador')?.value ===
        'PEQUEÑO GENERADOR QUE NO REQUIERE LICENCIA O PERMISO.'
      "
    >
      <h3 class="section-title">Documentos Del Proyecto</h3>

      <div class="file-group">
        <label>Carta de Solicitud (PDF) *</label>
        <input type="file" (change)="onFileSelected($event, 'carta_solicitud')" accept=".pdf" />
      </div>

      <div class="file-group">
        <label>
          Descripción técnica del proyecto
          <span *ngIf="isRequired('descripcion_tecnica_proyecto')" class="asterisk">*</span>
        </label>
        <input
          id="descripcion_tecnica_proyecto"
          type="file"
          (change)="onFileSelected($event, 'descripcion_tecnica_proyecto')"
          accept=".pdf"
        />
        <p class="help-text">
          Debe incluir planos, ubicación, área intervenida y objetivo del proyecto.
        </p>
      </div>

      <div class="file-group">
        <label [class.required]="isRequired('certificado_tradicion_libertad')">
          Certificado de Tradición y Libertad del inmueble
          <span *ngIf="isRequired('certificado_tradicion_libertad')" class="asterisk">*</span>
        </label>
        <input
          id="certificado_tradicion_libertad"
          type="file"
          (change)="onFileSelected($event, 'certificado_tradicion_libertad')"
          accept=".pdf"
        />
        <p class="help-text">Fecha de expedición no mayor a 3 meses.</p>
      </div>

      <div class="file-group">
        <label [class.required]="isRequired('autorizacion_bic')">
          Copia de la autorización de intervención de Bienes de Interés Cultural (BIC)
          <em>(si aplica)</em>
          <span *ngIf="isRequired('autorizacion_bic')" class="asterisk">*</span>
        </label>
        <input
          id="autorizacion_bic"
          type="file"
          (change)="onFileSelected($event, 'autorizacion_bic')"
          accept=".pdf"
        />
        <p class="help-text">Solo en caso de que el inmueble esté catalogado como BIC.</p>
      </div>

      <div class="file-group">
        <label>
          Registro de defunción del propietario del bien inmueble <em>(si aplica)</em>
       
        </label>
        <input
          id="registro_defuncion"
          type="file"
          (change)="onFileSelected($event, 'registro_defuncion')"
          accept=".pdf"
        />
        <p class="help-text">
          En caso de fallecimiento del propietario, se debe anexar este documento junto con los
          siguientes:
        </p>
        <ul class="help-text">
          <li>
            Radicación ante juzgado o notaría del proceso de sucesión, o documento privado notariado
            suscrito por los posibles herederos donde se manifieste que no hay herederos con mayor
            derecho y se comprometan a realizar los trámites de sucesión.
          </li>
          <li>Copia del documento de identificación del o los herederos.</li>
          <li>
            Copia del registro civil de nacimiento de los hijos o registro de matrimonio del cónyuge
            (según el caso).
          </li>
        </ul>
      </div>
    </div>

    <!-- Documentos para Pequeño o Gran Generador de RCD -->
    <div
      *ngIf="
        proyecto.get('tipo_de_generador')?.value === 'PEQUEÑO GENERADOR DE RCD' ||
        proyecto.get('tipo_de_generador')?.value === 'GRAN GENERADOR DE RCD'
      "
    >
      <h3 class="section-title">Documentos Del Proyecto</h3>

      <div class="file-group">
        <label>Carta de Solicitud (PDF) *</label>
        <input type="file" (change)="onFileSelected($event, 'carta_solicitud')" accept=".pdf" />
      </div>

      <div class="file-group">
        <label>
          Descripción técnica del proyecto
          <span *ngIf="isRequired('descripcion_tecnica_proyecto')" class="asterisk">*</span>
        </label>
        <input
          id="descripcion_tecnica_proyecto"
          type="file"
          (change)="onFileSelected($event, 'descripcion_tecnica_proyecto')"
          accept=".pdf"
        />
        <p class="help-text">
          Debe incluir planos, ubicación, área intervenida y objetivo del proyecto.
        </p>
      </div>

      <div class="file-group">
        <label [class.required]="isRequired('certificado_tradicion_libertad')">
          Certificado de Tradición y Libertad del inmueble
          <span *ngIf="isRequired('certificado_tradicion_libertad')" class="asterisk">*</span>
        </label>
        <input
          id="certificado_tradicion_libertad"
          type="file"
          (change)="onFileSelected($event, 'certificado_tradicion_libertad')"
          accept=".pdf"
        />
        <p class="help-text">Fecha de expedición no mayor a 3 meses.</p>
      </div>

      <div class="file-group">
        <label [class.required]="isRequired('autorizacion_bic')">
          Copia de la autorización de intervención de Bienes de Interés Cultural (BIC)
          <em>(si aplica)</em>
          <span *ngIf="isRequired('autorizacion_bic')" class="asterisk">*</span>
        </label>
        <input
          id="autorizacion_bic"
          type="file"
          (change)="onFileSelected($event, 'autorizacion_bic')"
          accept=".pdf"
        />
        <p class="help-text">Solo en caso de que el inmueble esté catalogado como BIC.</p>
      </div>

      <div class="file-group">
        <label>
          Registro de defunción del propietario del bien inmueble <em>(si aplica)</em>
        </label>
        <input
          id="registro_defuncion"
          type="file"
          (change)="onFileSelected($event, 'registro_defuncion')"
          accept=".pdf"
        />
        <p class="help-text">
          En caso de fallecimiento del propietario, se debe anexar este documento junto con los
          siguientes:
        </p>
        <ul class="help-text">
          <li>
            Radicación ante juzgado o notaría del proceso de sucesión, o documento privado notariado
            suscrito por los posibles herederos donde se manifieste que no hay herederos con mayor
            derecho y se comprometan a realizar los trámites de sucesión.
          </li>
          <li>Copia del documento de identificación del o los herederos.</li>
          <li>
            Copia del registro civil de nacimiento de los hijos o registro de matrimonio del cónyuge
            (según el caso).
          </li>
        </ul>
      </div>

      <h3 class="section-title">Documentos Para Pequeños y Grandes Generadores</h3>

      <div class="file-group">
        <label>
          Cuadro de cantidades de RCD a generar, discriminados por tipo de RCD
          <span *ngIf="isRequired('cuadro_cantidades_rcd')" class="asterisk">*</span>
        </label>
        <input
          id="cuadro_cantidades_rcd"
          type="file"
          (change)="onFileSelected($event, 'cuadro_cantidades_rcd')"
          accept=".pdf"
        />
        <p class="help-text">
          Debe seguir la clasificación establecida en el Artículo 2 de la Resolución 0472 de 2017.
        </p>
        <div class="error">Debes adjuntar el Cuadro de Cantidades de RCD.</div>
      </div>

      <div class="file-group">
        <label>
          Soporte de pago del PIN
          <span *ngIf="isRequired('soporte_pago_pin')" class="asterisk">*</span>
        </label>
        <input
          id="soporte_pago_pin"
          type="file"
          (change)="onFileSelected($event, 'soporte_pago_pin')"
          accept=".pdf"
        />
        <p class="help-text">Comprobante de pago asociado al trámite ambiental.</p>
      </div>

      <div class="file-group">
        <label class="required">
          Cronograma de actividades del proyecto
          <span class="asterisk">*</span>
        </label>
        <input
          id="cronograma_actividades"
          type="file"
          (change)="onFileSelected($event, 'cronograma_actividades')"
          accept=".pdf"
        />
        <p class="help-text">Debe incluir las fechas estimadas y responsables de cada actividad.</p>
      </div>

      <div class="file-group">
        <label class="required">
          Copia de los planos arquitectónicos aprobados por curaduría urbana
          <span class="asterisk">*</span>
        </label>
        <input
          id="planos_aprobados_curaduria"
          type="file"
          (change)="onFileSelected($event, 'planos_aprobados_curaduria')"
          accept=".pdf"
        />
        <p class="help-text">Planos oficiales debidamente aprobados por la curaduría urbana.</p>
      </div>

      <div class="file-group">
        <label class="required">
          Contrato de Obra y OTROSÍ, debidamente firmados por las partes
          <span class="asterisk">*</span>
        </label>
        <input
          id="contrato_obra_otros"
          type="file"
          (change)="onFileSelected($event, 'contrato_obra_otros')"
          accept=".pdf"
        />
        <p class="help-text">Aplica si la solicitud del PIN la realiza el contratista de obra.</p>
      </div>

      <div class="file-group">
        <label class="required">
          Copia de la resolución o licencia correspondiente
          <span class="asterisk">*</span>
        </label>
        <input
          id="resolucion_curaduria_o_licencia"
          type="file"
          (change)="onFileSelected($event, 'resolucion_curaduria_o_licencia')"
          accept=".pdf"
        />
        <p class="help-text">
          Puede ser licencia urbanística, de intervención u ocupación del espacio público, o
          licencia ambiental (según aplique).
        </p>
      </div>

      <div class="file-group">
        <label class="required">
          Programa de manejo ambiental de Residuos de Construcción y Demolición (RCD)
          <span class="asterisk">*</span>
        </label>
        <input
          id="programa_manejo_rcd_pdf"
          type="file"
          (change)="onFileSelected($event, 'programa_manejo_rcd_pdf')"
          accept=".pdf"
        />
        <p class="help-text">
          Formulado según los requisitos mínimos de la Resolución 1257 de 2021 y los establecidos
          por la autoridad ambiental.
        </p>
      </div>

      <div class="file-group">
        <label>
          Copia de la autorización de intervención de Bienes de Interés Cultural (BIC)
          <em>(si aplica)</em>
        </label>
        <input
          id="autorizacion_bicBigOrSmall"
          type="file"
          (change)="onFileSelected($event, 'autorizacion_bicBigOrSmall')"
          accept=".pdf"
        />
        <p class="help-text">
          Expedido por la Alcaldía Mayor de Cartagena (artículos 9 al 12 del Decreto 0404 de 2024).
        </p>
      </div>

      <div class="file-group">
        <label> Certificado de Planeación (si no se requiere licencia) </label>
        <input
          id="certificado_no_requiere_licencia"
          type="file"
          (change)="onFileSelected($event, 'certificado_no_requiere_licencia')"
          accept=".pdf"
        />
        <p class="help-text">
          Certificado expedido por la Secretaría de Planeación donde conste que no se requiere
          licencia de intervención y ocupación de espacio público.
        </p>
      </div>

      <div class="file-group">
        <label> Permiso de ocupación de cauce <em>(si aplica)</em> </label>
        <input
          id="permiso_ocupacion_cauce"
          type="file"
          (change)="onFileSelected($event, 'permiso_ocupacion_cauce')"
          accept=".pdf"
        />
        <p class="help-text">
          Copia del acto administrativo a través del cual se otorga el permiso de ocupación de
          cauce.
        </p>
      </div>
    </div>

    <!-- Nota general -->
    <p class="help-text final-note">
      Todos los documentos deben presentarse en formato PDF, con nombre del proyecto y fecha de
      emisión visibles.
    </p>

    <!-- Mensaje general de validación -->
    <div class="form-errors" *ngIf="DocumentsForm.invalid && DocumentsForm.touched">
      <p class="error">Revisa los campos marcados en rojo y adjunta los documentos obligatorios.</p>
    </div>

    <!-- Botones -->
    <div class="form-actions">
      <button mat-stroked-button type="button" (click)="prevStep()">Anterior</button>
      <button mat-flat-button color="primary" type="button" (click)="nextStep()">Siguiente</button>
    </div>
  </div>

  <!-- PASO 3 — INFORMACIÓN ADICIONAL -->
  <div *ngIf="step === 3" [formGroup]="infoextra">
    <h3>Información adicional</h3>

    <mat-form-field appearance="outline">
      <mat-label>Fecha de expedición del PIN</mat-label>
      <input matInput type="date" formControlName="fecha_expedicion_pin" />
      <mat-error *ngIf="isInvalid('fecha_expedicion_pin', infoextra)">
        Debes ingresar la fecha de expedición del PIN.
      </mat-error>
    </mat-form-field>

    <mat-form-field appearance="outline">
      <mat-label>Consecutivo SIGOB</mat-label>
      <input matInput formControlName="consecutivo_sigob" placeholder="Ej: 2025-000123" />
      <mat-error *ngIf="isInvalid('consecutivo_sigob', infoextra)">
        Debes ingresar el consecutivo SIGOB.
      </mat-error>
    </mat-form-field>
    <mat-form-field appearance="outline">
      <mat-label>Valor</mat-label>
      <input matInput formControlName="valor" placeholder="" />
      <mat-error *ngIf="isInvalid('valor', infoextra)"> Debes ingresar el valor. </mat-error>
    </mat-form-field>

    <div class="form-actions">
      <button mat-stroked-button (click)="prevStep()">Anterior</button>
      <button mat-flat-button color="primary" (click)="nextStep()">Siguiente</button>
    </div>
  </div>
  <!-- PASO 4 — RESUMEN FINAL -->
  <div *ngIf="step === 4">
    <!-- Resumen para PEQUEÑO GENERADOR SIN LICENCIA -->
    <div
      *ngIf="
        proyecto.get('tipo_de_generador')?.value ===
        'PEQUEÑO GENERADOR QUE NO REQUIERE LICENCIA O PERMISO.'
      "
    >
      <div class="summary-box">
        <h3>Resumen — Datos de Contacto</h3>
        <p>
          <strong>Tipo de solicitante:</strong> {{ contacto.get('tipo_de_solicitante')?.value }}
        </p>

        <ng-container *ngIf="contacto.get('tipo_de_solicitante')?.value === 'Persona Natural'">
          <p>
            <strong>Nombres y apellidos:</strong> {{ contacto.get('nombres_y_apellidos')?.value }}
          </p>
          <p>
            <strong>Documento de identidad:</strong>
            {{ contacto.get('documento_de_identidad')?.value }}
          </p>
        </ng-container>

        <ng-container *ngIf="contacto.get('tipo_de_solicitante')?.value === 'Persona Jurídica'">
          <p><strong>Razón social:</strong> {{ contacto.get('razon_social')?.value }}</p>
          <p><strong>NIT:</strong> {{ contacto.get('nit')?.value }}</p>
        </ng-container>

        <p><strong>Correo electrónico:</strong> {{ contacto.get('correo_electronico')?.value }}</p>
        <p><strong>Teléfono móvil:</strong> {{ contacto.get('telefono_movil')?.value }}</p>
        <p><strong>Teléfono fijo:</strong> {{ contacto.get('telefono_fijo')?.value }}</p>
        <p><strong>Localidad:</strong> {{ contacto.get('localidad')?.value }}</p>
        <p><strong>Barrio:</strong> {{ contacto.get('barrio')?.value }}</p>
        <p>
          <strong>Dirección de correspondencia:</strong>
          {{ contacto.get('direccion_de_correspondencia_del_solicitante')?.value }}
        </p>
      </div>

      <h3>Resumen del Proyecto</h3>
      <div class="summary-box">
        <p><strong>Tipo de Generador:</strong> {{ proyecto.get('tipo_de_generador')?.value }}</p>
        <p><strong>Localidad:</strong> {{ proyecto.get('localidad_proyecto')?.value }}</p>
        <p><strong>Barrio:</strong> {{ proyecto.get('barrio_proyecto')?.value }}</p>
        <p>
          <strong>Dirección del Proyecto:</strong>
          {{ proyecto.get('direccion_del_proyecto')?.value }}
        </p>
        <p>
          <strong>Fecha Inicio:</strong>
          {{ proyecto.get('fecha_inicio')?.value | date : 'dd/MM/yyyy' }}
        </p>
        <p>
          <strong>Fecha Final:</strong>
          {{ proyecto.get('fecha_final')?.value | date : 'dd/MM/yyyy' }}
        </p>
        <p>
          <strong>Nombre del Proyecto:</strong> {{ proyecto.get('nombre_del_proyecto')?.value }}
        </p>

        <div *ngFor="let predio of proyecto.get('datos_predios')?.value; let i = index">
          <p>
            <strong>Predio {{ i + 1 }}</strong>
          </p>
          <p><strong>Referencia Catastral:</strong> {{ predio.referencia_catastral }}</p>
          <p><strong>Matrícula Inmobiliaria:</strong> {{ predio.matricula_inmobiliaria }}</p>
          <p>
            <strong>Descripción del proyecto o actividad:</strong><br />{{
              proyecto.get('descripcion_del_proyecto_o_actividad_a_ejecutar')?.value
            }}
          </p>
          <p>
            <strong>Área a Intervenir (m²):</strong>
            {{ proyecto.get('area_a_intervenir_m2')?.value }}
          </p>
          <p>
            <strong>Cantidad de RCD a generar (Toneladas):</strong>
            {{ proyecto.get('cantidad_de_rcd_a_generar_toneladas')?.value }}
          </p>
          <p><strong>Latitud:</strong> {{ proyecto.get('latitud')?.value }}</p>
          <p><strong>Longitud:</strong> {{ proyecto.get('longitud')?.value }}</p>
        </div>

        <h3>Documentos cargados</h3>
        <ul>
          <li *ngFor="let doc of getUploadedDocuments()">{{ doc }}</li>
        </ul>

        <h3>Información adicional</h3>
        <p><strong>Fecha PIN:</strong> {{ infoextra.get('fecha_expedicion_pin')?.value }}</p>
        <p><strong>Consecutivo SIGOB:</strong> {{ infoextra.get('consecutivo_sigob')?.value }}</p>
        <p><strong>Valor:</strong> {{ infoextra.get('valor')?.value }}</p>
      </div>
    </div>

    <!-- Resumen para PEQUEÑO/GRAN GENERADOR DE RCD -->
    <div
      *ngIf="
        proyecto.get('tipo_de_generador')?.value === 'PEQUEÑO GENERADOR DE RCD' ||
        proyecto.get('tipo_de_generador')?.value === 'GRAN GENERADOR DE RCD'
      "
    >
      <h3>Resumen del Proyecto</h3>
      <div class="summary-box">
        <p><strong>Tipo de Generador:</strong> {{ proyecto.get('tipo_de_generador')?.value }}</p>
        <p><strong>Localidad:</strong> {{ proyecto.get('localidad_proyecto')?.value }}</p>
        <p><strong>Barrio:</strong> {{ proyecto.get('barrio_proyecto')?.value }}</p>
        <p>
          <strong>Dirección del Proyecto:</strong>
          {{ proyecto.get('direccion_del_proyecto')?.value }}
        </p>
        <p>
          <strong>Fecha Inicio:</strong>
          {{ proyecto.get('fecha_inicio')?.value | date : 'dd/MM/yyyy' }}
        </p>
        <p>
          <strong>Fecha Final:</strong>
          {{ proyecto.get('fecha_final')?.value | date : 'dd/MM/yyyy' }}
        </p>
        <p>
          <strong>Nombre del Proyecto:</strong> {{ proyecto.get('nombre_del_proyecto')?.value }}
        </p>

        <div *ngFor="let predio of proyecto.get('datos_predios')?.value; let i = index">
          <p>
            <strong>Predio {{ i + 1 }}</strong>
          </p>
          <p><strong>Referencia Catastral:</strong> {{ predio.referencia_catastral }}</p>
          <p><strong>Matrícula Inmobiliaria:</strong> {{ predio.matricula_inmobiliaria }}</p>
          <p>
            <strong>Descripción del proyecto o actividad:</strong><br />{{
              proyecto.get('descripcion_del_proyecto_o_actividad_a_ejecutar')?.value
            }}
          </p>
          <p>
            <strong>Área a Intervenir (m²):</strong>
            {{ proyecto.get('area_a_intervenir_m2')?.value }}
          </p>
          <p>
            <strong>Cantidad de RCD a generar (Toneladas):</strong>
            {{ proyecto.get('cantidad_de_rcd_a_generar_toneladas')?.value }}
          </p>
          <p><strong>Latitud:</strong> {{ proyecto.get('latitud')?.value }}</p>
          <p><strong>Longitud:</strong> {{ proyecto.get('longitud')?.value }}</p>
        </div>

        <h3>Tipo de Licencia</h3>
        <div
          class="summary-section"
          *ngFor="
            let bloque of [
              'urbanizacion_block_0100',
              'construccion_block_0100',
              'bic_block_0100',
              'espacio_publico_block_0100'
            ];
            let idx = index
          "
        >
          <h4>
            {{
              [
                'Urbanización',
                'Construcción',
                'Permiso BIC',
                'Intervención/Ocupación Espacio Público'
              ][idx]
            }}
          </h4>
          <ul *ngIf="getLicenciaOptions(bloque).length > 0; else noAplica">
            <li *ngFor="let opcion of getLicenciaOptions(bloque)">{{ opcion }}</li>
          </ul>
          <ng-template #noAplica><p>— No aplica.</p></ng-template>
        </div>

        <hr />
        <div class="summary-section">
          <h3>Demolición por Declaración de Estado de Ruina</h3>
          <p>
            Respuesta: <strong>{{ getDemolicionRespuesta() || 'NO' }}</strong>
          </p>
        </div>

        <hr />
        <div class="summary-section">
          <h3>No. Resolución Licencia / Autorización BIC</h3>
          <p>
            Número: <strong>{{ getResolucionNumero() || 'N/A' }}</strong>
          </p>
        </div>

        <h3>Documentos cargados</h3>
        <ul>
          <li *ngFor="let doc of getUploadedDocuments()">{{ doc }}</li>
        </ul>

        <h3>Información adicional</h3>
        <p><strong>Fecha PIN:</strong> {{ infoextra.get('fecha_expedicion_pin')?.value }}</p>
        <p><strong>Consecutivo SIGOB:</strong> {{ infoextra.get('consecutivo_sigob')?.value }}</p>
        <p><strong>Valor:</strong> {{ infoextra.get('valor')?.value }}</p>
      </div>
    </div>

    <!-- Botones finales -->
    <div class="form-actions">
      <button mat-stroked-button (click)="prevStep()">Anterior</button>
      <button mat-flat-button color="accent" (click)="onSubmit()" [disabled]="isSubmitting"> Guardar</button>
    </div>
  </div>
</div>
